#  系统级IO

## Unix I/O

下面是linux的目录结构：

![image-20200923150517079](系统级IO.assets/image-20200923150517079.png)

输入输出操作都以统一一致的方式来执行：

* 打开文件。内核会返回一个小的非负整数，叫做描述符，它来标识这个文件，内核会记录有关文件的所有信息，应用程序只需要记住这个描述符。
* Linux Shell 创建进程的时候都会打开3个文件:0,1,2.其中头文件<unistd.h>定义了常量STDIN_FILENO,STDOUT_FILENO,STDERR_FILENO.代替显式的描述符常量。
* 改变当前文件位置：每个打开的文件，内核保持一个文件位置k,初始为0，改值是相对于文件起始的偏移，应用程序可以通过seek操作，显示的设置当前位置为k
* 读写文件：文件复制n>0个字节到内存，从k位置开始，然后k增加到k+n。假如一个大小为m字节的文件，当k>=m的时候，会触发EOF(end-of-file)，应用程序能够检测到这个条件。但是文件结尾没有明确的"EOF符号"。
* 关闭文件：当完成文件访问之后，它通知内核关闭这个文件。内核释放文件打开时创建的数据结构，并将描述符恢复到可用的描述符池中。无论一个进程因为何种原因终止，内核都会关闭所有打开的文件并释放它的内存资源。



